{{- /* --- 自定义脚本开始 --- */}}

{{- /* 1. 您的动态标题脚本 */}}


{{- /* 1. Waline 评论脚本 (只有在文章页等需要评论的地方加载) */ -}}
{{- if .IsPage }}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const walineContainer = document.getElementById('waline');
        if (walineContainer) {
            import('https://unpkg.com/@waline/client@v3/dist/waline.js').then(({ init }) => {
                // 从 Hugo 配置中获取所有 Waline 相关的参数
                const hugoConfig = JSON.parse(`{{ .Site.Params.waline | jsonify | safeJS }}`);
                
                // 初始化 Waline
                init({
                    // 1. 传入所有从 Hugo 获取的配置
                    ...hugoConfig,

                    // 2. 手动修正 Hugo 自动转小写的关键参数
                    serverURL: hugoConfig.serverurl,
                    requiredMeta: hugoConfig.requiredmeta,
                    
                    // 3. 传入页面特有的固定参数
                    el: '#waline',
                    path: '{{ .Permalink | relURL }}',
                });
            }).catch(e => console.error('Waline 初始化失败:', e));
        }
    });
</script>
{{- end }}


{{- /* 2. 聊天气泡的 HTML 骨架 (全局加载) */ -}}
<div id="chat-bubble">
    <p id="chat-bubble-text">你好呀！点我试试？</p>
</div>

{{- /* 模块二：加载脚本的诊断过程 (已修正语法) */ -}}  

{{- /* 探针 #1: 确认诊断开始 */ -}}  
{{ warnf "--- [JS诊断开始] ---" }}  

{{- /* 关键步骤：尝试获取 JS 文件资源 */ -}}  
{{ $customJS := resources.Get "js/extended/custom-scripts.js" }}  

{{- /* 探针 #2: 检查获取到的资源是什么 */ -}}  
{{ warnf "[诊断] resources.Get 的结果是: %v" $customJS }}  

{{- /* 这是最终的判断逻辑 */ -}}  
{{ if $customJS }}  
    {{- /* 如果 $customJS 不是空的，就执行这里 */ -}}  
    {{ warnf "[诊断] 结果: 成功。准备渲染 script 标签。" }}  
    <script src="{{ $customJS.RelPermalink }}" defer></script>  
{{ else }}  
    {{- /* 如果 $customJS 是空的，就执行这里 */ -}}  
    {{ warnf "[诊断] 结果: 失败！JS 文件未找到，script 标签被跳过！请检查 assets 目录下的文件路径。" }}  
{{ end }}  