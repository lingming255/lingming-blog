---
date: '2025-08-08T13:34:33.802214'
draft: false
publish: true
tags:
- 网站部署
title: lingming.art 持久化部署作战手册 v2.0
---

# lingming.art 持久化部署作战手册 v2.0

## 一、核心理念：系统工程

本手册旨在将个人网站 `lingming.art` 的部署与维护视为一项可解构、可规划、可复制的系统工程。我们的目标是构建一个高可用、高内聚、低耦合、易于维护的自动化发布系统。

---

## 二、系统架构

- **域名服务**: Cloudflare
- **安全隧道**: Cloudflare Tunnel (`cloudflared`)
- **Web 服务器**: Caddy 2
- **内容生成**: Hugo (静态网站生成器)
- **版本控制**: Git
- **运行环境**: Docker on NAS

### 流程图

`开发者电脑 (Hugo/Git)` -> `Git Push` -> `NAS (文件同步)` -> `/volume1/myBlog/public` -> `Caddy (读取)` -> `Cloudflare Tunnel (传输)` -> `Cloudflare CDN` -> `访客`

---

## 三、标准作战流程 (SOP)

1. **内容创作 (本地)**: 在个人电脑的博客源文件目录中，使用Markdown创作新文章。
2. **本地编译与预览**:
    
    ```bash
    hugo server -D
    ```
    
    在 `http://localhost:1313` 预览效果。
3. **最终编译**:
    
    ```bash
    # 确保 hugo.toml 中的 baseURL 正确hugo
    ```
    
    此命令会在本地生成全新的 `public` 文件夹。
4. **版本控制**:
    
    ```bash
    git add .git commit -m "发布新文章：[文章标题]"git push
    ```
    
5. **部署到服务器**:
    - **清空旧文件**: 删除 NAS 上的 `/volume1/myBlog/public` 文件夹内的所有内容。
    - **上传新文件**: 将本地电脑上生成的全新 `public` 文件夹内的**所有内容**，上传至 NAS 的 `/volume1/myBlog/public/` 目录下。
6. **验证**: 清空浏览器缓存或使用无痕模式，访问 `https://lingming.art`。

---

## 四、紧急预案与实战经验附录 (v2.0新增)

这是在初次部署战役中总结的宝贵经验，用于快速诊断和解决突发问题。

### **状况一：排版混乱，CSS/JS丢失，搜索和交互图失效**

- **症状**: 网站只有纯文本，所有样式、功能模块全部丢失。浏览器控制台（F12）报大量资源加载失败。
- **诊断**: 这是典型的**资源路径错误**。
- **根源**: `hugo.toml` (或 `config.toml`) 文件中的 `baseURL` 配置错误。它可能被设置为 `http://example.org/` 或 `http://localhost:1313/`。
- **解决方案**:
    1. 打开博客源文件中的 `hugo.toml` 文件。
    2. 确保 `baseURL` 被正确设置为你的最终域名：`baseURL = "https://lingming.art"`。
    3. **必须重新执行“标准作战流程”的第3步和第5步**，即重新编译并重新上传 `public` 文件夹。仅修改配置而未重新编译是无效的。

### **状况二：浏览器显示 "HTTP ERROR 404"**

- **症状**: 访问网站直接显示 404 Not Found 页面。
- **诊断**: 网络通路正常，但 Web 服务器 (Caddy) 在其根目录中找不到 `index.html`。
- **根源**: 文件部署结构错误。最常见的原因是将 `public` 文件夹本身上传了，导致文件路径变成了 `/volume1/myBlog/public/public/index.html`。
- **解决方案**:
    1. 通过 SSH 登录 NAS，执行侦察指令：`ls -l /volume1/myBlog/public`。
    2. **正确状态**应直接列出 `index.html` 和 `css/`, `js/` 等文件/夹。
    3. **错误状态**只会列出一个名为 `public` 的文件夹。
    4. 如果是错误状态，请删除该文件夹，并严格按照“标准作战流程”第5步，只上传 `public` 文件夹**内部**的内容。

### **状况三：浏览器显示 "Error 1033 Cloudflare Tunnel error"**

- **症状**: 出现 Cloudflare 的错误页面，明确指出 Tunnel 无法连接。
- **诊断**: 这是**网络连接层**的故障。你的 NAS 与 Cloudflare 数据中心之间的安全隧道中断。
- **根源**: `cloudflared` 进程可能因网络波动或长时间运行而失去“心跳”。
- **解决方案**:
    1. 登录 NAS 的 Docker 管理界面。
    2. 找到名为 `my-blog-tunnel` 的容器。
    3. **重启该容器**。此操作会强制 `cloudflared` 重新建立一个健康的隧道连接。

### **状况四 (潜在风险): 本地正常，服务器异常 (大小写问题)**

- **症状**: 某个链接或图片在本地预览时正常，部署到服务器后 404。
- **诊断**: 跨平台开发时的文件名大小写不一致问题。
- **根源**: Windows/macOS 文件系统不区分大小写，而服务器上的 Linux 严格区分。
- **解决方案 (永久性加固)**:
    1. 在本地电脑的博客项目根目录下，执行一次性指令，强制 Git 区分大小写：
        
        ```bash
        git config core.ignorecase false
        ```
        
    2. **建立个人军规**: 所有新创建的文件和文件夹，名称**一律使用小写字母**，单词间用中划线 `-` 分隔。

### **状况五 (幽灵Bug): 不相关的服务（如笔记同步）出现异常**

- **症状**: 部署博客后，其他依赖 Cloudflare 域名的服务突然指向了博客的内容。
- **诊断**: 系统中存在**“幽灵隧道”**。
- **根源**: 存在一个已废弃但仍在运行的旧 `cloudflare-tunnel` 容器，其配置不正确，抢占了其他服务的流量。
- **解决方案 (系统净化)**:
    1. 定期执行 `docker ps -a` 审查所有正在运行和已停止的容器。
    2. **果断删除**任何不再需要的、废弃的容器，特别是与网络代理相关的容器，以确保系统不存在冗余和冲突的指令源。